맞아, 원래 서브그래프 구조가 더 정교했지! 트랜스크립트 확인해서 원래 계획대로 다시 그려줄게.

```
══════════════════════════════════════════════════════════════════════════════════
                         MEAL PLANNER AGENT GRAPH
══════════════════════════════════════════════════════════════════════════════════

                              ┌─────────────┐
                              │  __start__  │
                              └──────┬──────┘
                                     │
                                     ▼
                    ┌────────────────────────────────┐
                    │     nutrition_calculator       │
                    │  ────────────────────────────  │
                    │  • BMR/TDEE 계산               │
                    │  • 일일 매크로 목표            │
                    │  • 끼니당 목표/예산 분배       │
                    └────────────────┬───────────────┘
                                     │
        ┌────────────────────────────┼─────────────────────────────────────────┐
        │                            │                                         │
        │                            ▼                                         │
        │  ╔═══════════════════════════════════════════════════════════════╗   │
        │  ║              MEAL_PLANNING_SUBGRAPH                           ║   │
        │  ╠═══════════════════════════════════════════════════════════════╣   │
        │  ║                                                               ║   │
        │  ║    ┌─────────────────────────────────────────────────────┐    ║   │
        │  ║    │           meal_planning_supervisor                  │    ║   │
        │  ║    │  (3 전문가에게 작업 분배)                           │    ║   │
        │  ║    └───────────────────────┬─────────────────────────────┘    ║   │
        │  ║                            │                                  ║   │
        │  ║           ┌────────────────┼────────────────┐                 ║   │
        │  ║           │                │                │                 ║   │
        │  ║           ▼                ▼                ▼                 ║   │
        │  ║  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐           ║   │
        │  ║  │     🥗       │ │     👨‍🍳       │ │     💰       │           ║   │
        │  ║  │ nutritionist │ │    chef      │ │   budget     │  병렬     ║   │
        │  ║  │──────────────│ │──────────────│ │──────────────│           ║   │
        │  ║  │ 영양 균형    │ │ 맛/조리      │ │ 비용 효율    │           ║   │
        │  ║  │ 매크로 충족  │ │ 시간/난이도  │ │ 예산 준수    │           ║   │
        │  ║  │ 질병 고려    │ │ 레시피 품질  │ │ 가성비       │           ║   │
        │  ║  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘           ║   │
        │  ║         │                │                │                   ║   │
        │  ║         └────────────────┼────────────────┘                   ║   │
        │  ║                          │                                    ║   │
        │  ║                          ▼                                    ║   │
        │  ║    ┌─────────────────────────────────────────────────────┐    ║   │
        │  ║    │              conflict_resolver                      │    ║   │
        │  ║    │  ─────────────────────────────────────────────────  │    ║   │
        │  ║    │  • 3 전문가 추천 비교                               │    ║   │
        │  ║    │  • 최적 메뉴 1개 결정                               │    ║   │
        │  ║    │  • 상세 레시피/영양정보 생성                        │    ║   │
        │  ║    └─────────────────────────────────────────────────────┘    ║   │
        │  ║                                                               ║   │
        │  ╚═══════════════════════════════════════════════════════════════╝   │
        │                            │                                         │
        │                            ▼                                         │
        │  ╔═══════════════════════════════════════════════════════════════╗   │
        │  ║              VALIDATION_SUBGRAPH                              ║   │
        │  ╠═══════════════════════════════════════════════════════════════╣   │
        │  ║                                                               ║   │
        │  ║    ┌─────────────────────────────────────────────────────┐    ║   │
        │  ║    │           validation_supervisor                     │    ║   │
        │  ║    │  (3 검증기에게 작업 분배)                           │    ║   │
        │  ║    └───────────────────────┬─────────────────────────────┘    ║   │
        │  ║                            │                                  ║   │
        │  ║           ┌────────────────┼────────────────┐                 ║   │
        │  ║           │                │                │                 ║   │
        │  ║           ▼                ▼                ▼                 ║   │
        │  ║  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐           ║   │
        │  ║  │     🔢       │ │     ⚠️        │ │     ⏱️        │           ║   │
        │  ║  │  nutrition   │ │   allergy    │ │    time      │  병렬     ║   │
        │  ║  │  _checker    │ │   _checker   │ │   _checker   │           ║   │
        │  ║  │──────────────│ │──────────────│ │──────────────│           ║   │
        │  ║  │ 칼로리 ±20%  │ │ 알레르기     │ │ 조리시간     │           ║   │
        │  ║  │ 단백질 ±20%  │ │ 제외식품     │ │ 제한 준수    │           ║   │
        │  ║  │ 나트륨/당류  │ │ 22종 체크    │ │              │           ║   │
        │  ║  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘           ║   │
        │  ║         │                │                │                   ║   │
        │  ║         └────────────────┼────────────────┘                   ║   │
        │  ║                          │                                    ║   │
        │  ║                          ▼                                    ║   │
        │  ║    ┌─────────────────────────────────────────────────────┐    ║   │
        │  ║    │            validation_aggregator                    │    ║   │
        │  ║    │  ─────────────────────────────────────────────────  │    ║   │
        │  ║    │  • 3개 검증 결과 수집                               │    ║   │
        │  ║    │  • Pass/Fail 목록 생성                              │    ║   │
        │  ║    │  • 실패 원인 상세 기록                              │    ║   │
        │  ║    └─────────────────────────────────────────────────────┘    ║   │
        │  ║                                                               ║   │
        │  ╚═══════════════════════════════════════════════════════════════╝   │
        │                            │                                         │
        │                            ▼                                         │
        │           ┌────────────────────────────────┐                         │
        │           │        decision_maker          │                         │
        │           │  ────────────────────────────  │                         │
        │           │  • 검증 결과 종합 판정         │                         │
        │           │  • 다음 액션 라우팅            │                         │
        │           └────────────────┬───────────────┘                         │
        │                            │                                         │
        │           ┌────────────────┼────────────────┐                        │
        │           │                │                │                        │
        │           ▼                ▼                ▼                        │
        │    ┌────────────┐   ┌────────────┐   ┌────────────┐                  │
        │    │  ✅ PASS   │   │  🔄 RETRY  │   │  ❌ ERROR  │                  │
        │    │ 모두 통과  │   │ 1~2개 실패 │   │ 5회 초과   │                  │
        │    └─────┬──────┘   └─────┬──────┘   └─────┬──────┘                  │
        │          │                │                │                         │
        │          ▼                ▼                ▼                         │
        │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │
        │  │ day_iterator │  │ retry_router │  │   __end__    │                │
        │  │──────────────│  │──────────────│  │   (에러)     │                │
        │  │ 다음 끼니    │  │ 실패 분석    │  └──────────────┘                │
        │  │ 또는 다음 날 │  │ 재실행 결정  │                                  │
        │  └──────┬───────┘  └──────┬───────┘                                  │
        │         │                 │                                          │
        │         │                 ├─── 1개 실패 ───► 해당 노드만 재실행 ─────┤
        │         │                 │                                          │
        │         │                 └─── 2개+ 실패 ──► meal_planning 전체 ─────┤
        │         │                                                            │
        │         ▼                                                            │
        │  ┌──────────────┐                                                    │
        │  │ 모든 끼니    │                                                    │
        │  │ 완료 체크    │                                                    │
        │  └──────┬───────┘                                                    │
        │         │                                                            │
        │    ┌────┴────┐                                                       │
        │    │         │                                                       │
        │    ▼         ▼                                                       │
        │  ┌────┐  ┌──────────────────┐                                        │
        │  │END │  │ 다음 끼니/날     │────────────────────────────────────────┘
        │  │ ✅ │  │ nutrition_calc   │
        │  └────┘  └──────────────────┘
        │
        └──────────────────────────────────────────────────────────────────────┘



══════════════════════════════════════════════════════════════════════════════════
                              [ RETRY ROUTER 상세 ]
══════════════════════════════════════════════════════════════════════════════════

                         ┌─────────────────────┐
                         │    retry_router     │
                         └──────────┬──────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
           ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
           │ nutrition    │ │ allergy      │ │ time         │
           │ 만 실패      │ │ 만 실패      │ │ 만 실패      │
           └──────┬───────┘ └──────┬───────┘ └──────┬───────┘
                  │                │                │
                  ▼                ▼                ▼
           ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
           │ nutritionist │ │ chef         │ │ chef         │
           │ 만 재실행    │ │ 만 재실행    │ │ 만 재실행    │
           └──────────────┘ └──────────────┘ └──────────────┘
                  │                │                │
                  └────────────────┴────────────────┘
                                   │
                                   ▼
                         ┌─────────────────────┐
                         │  conflict_resolver  │
                         │  (재통합)           │
                         └─────────────────────┘



                    ┌───────────────────────────────┐
                    │      2개 이상 실패시          │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │  meal_planning_supervisor     │
                    │  (전체 재실행)                │
                    └───────────────────────────────┘



══════════════════════════════════════════════════════════════════════════════════
                              [ 범 례 ]
══════════════════════════════════════════════════════════════════════════════════

    ╔═══════════════╗
    ║   SUBGRAPH    ║     서브그래프 (독립 실행 단위)
    ╚═══════════════╝

    ┌───────────────┐
    │     node      │     일반 노드
    └───────────────┘

         │
         ▼                순차 실행

     ────┼────            병렬 실행 (Send API)
     │   │   │



══════════════════════════════════════════════════════════════════════════════════
                         [ 실행 흐름 요약 ]
══════════════════════════════════════════════════════════════════════════════════

  1️⃣  nutrition_calculator
      └─► 사용자 프로필 → 영양 목표/예산 계산

  2️⃣  MEAL_PLANNING_SUBGRAPH
      ├─► supervisor: 3 전문가에게 병렬 작업 분배 (Send API)
      ├─► nutritionist + chef + budget: 각자 메뉴 추천
      └─► conflict_resolver: 3개 → 1개 최종 메뉴

  3️⃣  VALIDATION_SUBGRAPH  
      ├─► supervisor: 3 검증기에게 병렬 작업 분배 (Send API)
      ├─► nutrition + allergy + time checker: 각자 검증
      └─► aggregator: 검증 결과 수집

  4️⃣  decision_maker
      ├─► ✅ 모두 통과 → day_iterator → 다음 끼니/날
      ├─► 🔄 1개 실패 → retry_router → 해당 전문가만 재실행
      ├─► 🔄 2개+ 실패 → retry_router → meal_planning 전체 재실행
      └─► ❌ 5회 초과 → 에러 종료

  5️⃣  day_iterator
      ├─► 끼니 남음 → nutrition_calculator (다음 끼니)
      └─► 모든 날 완료 → __end__ (성공)



══════════════════════════════════════════════════════════════════════════════════
                         [ 재시도 매핑 ]
══════════════════════════════════════════════════════════════════════════════════

    실패한 검증기          재실행 대상
    ─────────────────────────────────────────
    nutrition_checker  →   nutritionist
    allergy_checker    →   chef (재료 변경)
    time_checker       →   chef (레시피 변경)

    2개 이상 실패      →   meal_planning 전체

══════════════════════════════════════════════════════════════════════════════════
```
