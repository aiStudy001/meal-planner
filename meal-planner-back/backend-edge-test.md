## 백엔드 엣지 테스트 체크리스트

### 1️⃣ 기본 플로우 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  기본 동작 확인                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 1일 1끼 최소 플로우                                                      │
│    └─ 입력 → 영양계산 → 전문가3명 → 통합 → 검증3개 → 완료                   │
│                                                                             │
│  □ 1일 3끼 기본 플로우                                                      │
│    └─ 아침 → 점심 → 저녁 순차 생성 확인                                     │
│                                                                             │
│  □ 7일 3끼 전체 플로우 (21끼)                                               │
│    └─ 전체 완료까지 정상 동작                                               │
│    └─ 예상 소요시간 측정                                                    │
│                                                                             │
│  □ SSE 스트리밍 이벤트                                                      │
│    └─ 각 노드별 이벤트 정상 전송                                            │
│    └─ 클라이언트 연결 끊김 시 graceful 처리                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 2️⃣ 사용자 페르소나별 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 1: 직장인 다이어터                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 다이어트 (-500kcal)                                                │
│  • 성별/나이: 남성, 30세, 175cm, 80kg                                       │
│  • 활동량: 보통 (x1.375)                                                    │
│  • 제한: 없음                                                               │
│  • 조리: 15분 이내, 초급                                                    │
│  • 예산: 주 70,000원                                                        │
│  • 기간: 7일 3끼                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 예상 칼로리 ~1,600kcal/일 계산 확인                                      │
│  □ 간단한 메뉴 추천 (15분 이내)                                             │
│  □ 끼니당 ~3,300원 예산 준수                                                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 2: 헬스 벌크업                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 벌크업 (+500kcal)                                                  │
│  • 성별/나이: 남성, 25세, 180cm, 75kg                                       │
│  • 활동량: 매우 높음 (x1.725)                                               │
│  • 제한: 없음                                                               │
│  • 조리: 30분 이내, 중급                                                    │
│  • 예산: 주 150,000원                                                       │
│  • 기간: 7일 4끼 (간식 포함)                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 예상 칼로리 ~3,200kcal/일 계산 확인                                      │
│  □ 고단백 메뉴 추천 (단백질 40% 비율)                                       │
│  □ 4끼 배분 정상 동작                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 3: 비건 여성                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 유지                                                               │
│  • 성별/나이: 여성, 28세, 165cm, 55kg                                       │
│  • 활동량: 보통                                                             │
│  • 제한: 비건 (모든 동물성 제외)                                            │
│  • 조리: 30분 이내, 중급                                                    │
│  • 예산: 주 100,000원                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 동물성 재료 완전 배제 확인                                               │
│  □ 식물성 단백질 메뉴 (두부, 콩, 견과류)                                    │
│  □ 비건 대체재 활용 여부                                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 4: 당뇨+고혈압 복합                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 질병관리                                                           │
│  • 성별/나이: 남성, 55세, 170cm, 78kg                                       │
│  • 활동량: 낮음                                                             │
│  • 건강상태: 당뇨, 고혈압                                                   │
│  • 조리: 제한 없음, 고급                                                    │
│  • 예산: 주 120,000원                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 당류 8g 이하/끼니 제한 준수                                              │
│  □ 나트륨 667mg 이하/끼니 제한 준수                                         │
│  □ 저GI 식품 우선 추천                                                      │
│  □ 두 조건 동시 만족 메뉴 생성                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 5: 다중 알레르기                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 유지                                                               │
│  • 알레르기: 우유, 계란, 밀, 땅콩, 대두                                     │
│  • 조리: 30분 이내, 중급                                                    │
│  • 예산: 주 100,000원                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 5개 알레르기 성분 완전 배제                                              │
│  □ 교차 오염 가능 재료 체크                                                 │
│  □ 대체 재료 활용 (글루텐프리 등)                                           │
│  □ 검증 실패 → 재시도 정상 동작                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 6: 극한 저예산                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 유지                                                               │
│  • 예산: 주 35,000원 (끼니당 ~1,600원)                                      │
│  • 조리: 제한 없음                                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 초저가 식재료 활용 (계란, 두부, 콩나물)                                  │
│  □ 예산 초과 없이 영양 목표 달성                                            │
│  □ budget 에이전트 영향력 확인                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  페르소나 7: 시간 극한                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 목표: 다이어트                                                           │
│  • 조리: 15분 이내, 초급                                                    │
│  • 예산: 주 100,000원                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  □ 모든 메뉴 15분 이내 조리 가능                                            │
│  □ 초급 난이도 레시피만 추천                                                │
│  □ time_checker 검증 통과율                                                 │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 3️⃣ 재시도 로직 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  재시도 시나리오                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 단일 검증 실패 → 해당 전문가만 재실행                                    │
│    ├─ nutrition_checker 실패 → nutritionist 재실행                          │
│    ├─ allergy_checker 실패 → chef 재실행                                    │
│    └─ time_checker 실패 → chef 재실행                                       │
│                                                                             │
│  □ 복수 검증 실패 → meal_planning 전체 재실행                               │
│    ├─ nutrition + allergy 동시 실패                                         │
│    ├─ nutrition + time 동시 실패                                            │
│    └─ 3개 모두 실패                                                         │
│                                                                             │
│  □ 재시도 횟수 제한                                                         │
│    ├─ 5회 이내 성공 케이스                                                  │
│    └─ 5회 초과 → 에러 종료 케이스                                           │
│                                                                             │
│  □ 재시도 후 상태 정리                                                      │
│    ├─ validation_results 리셋 확인                                          │
│    ├─ expert_recommendations 적절히 유지/리셋                               │
│    └─ retry_count 증가 확인                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 4️⃣ 검증 로직 상세 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  nutrition_checker                                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 칼로리 ±20% 경계값                                                       │
│    ├─ 목표 500kcal → 400~600 통과                                          │
│    ├─ 399kcal → 실패                                                        │
│    └─ 601kcal → 실패                                                        │
│                                                                             │
│  □ 단백질 최소값 검증                                                       │
│    └─ 목표의 80% 미만 시 실패                                               │
│                                                                             │
│  □ 질병별 제한 검증                                                         │
│    ├─ 당뇨: 당류 8g 초과 시 실패                                            │
│    ├─ 고혈압: 나트륨 667mg 초과 시 실패                                     │
│    └─ 고지혈증: 포화지방 5g 초과 시 실패                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  allergy_checker                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 직접 매칭                                                                │
│    └─ "우유" 알레르기 → 재료에 "우유" 포함 시 실패                          │
│                                                                             │
│  □ 파생 재료 매칭                                                           │
│    ├─ "우유" → 치즈, 버터, 크림, 요거트                                     │
│    ├─ "계란" → 마요네즈, 난황, 난백                                         │
│    ├─ "밀" → 밀가루, 빵, 면, 파스타                                         │
│    └─ "대두" → 두부, 된장, 간장, 두유                                       │
│                                                                             │
│  □ 복합 알레르기 처리                                                       │
│    └─ 5개 이상 알레르기 동시 체크                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  time_checker                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 시간 제한 경계값                                                         │
│    ├─ 15분 제한 → 15분 통과, 16분 실패                                      │
│    ├─ 30분 제한 → 30분 통과, 31분 실패                                      │
│    └─ 제한 없음 → 180분까지 통과                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 5️⃣ 에러 핸들링 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  LLM 관련 에러                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ API 타임아웃 (60초)                                                      │
│    └─ 노드별 타임아웃 처리 확인                                             │
│                                                                             │
│  □ Rate Limit 에러                                                          │
│    └─ 429 응답 시 재시도 또는 에러 메시지                                   │
│                                                                             │
│  □ JSON 파싱 실패                                                           │
│    └─ LLM 응답이 JSON 형식 아닐 때 처리                                     │
│                                                                             │
│  □ 빈 응답                                                                  │
│    └─ content가 비어있을 때 처리                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  검색 관련 에러                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ Tavily API 실패                                                          │
│    └─ Fallback (Option B API) 동작 확인                                     │
│                                                                             │
│  □ Option B API 실패                                                        │
│    └─ Fallback (로컬 CSV) 동작 확인                                         │
│                                                                             │
│  □ 모든 검색 실패                                                           │
│    └─ LLM 자체 추천으로 진행                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  상태 관련 에러                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 필수 필드 누락                                                           │
│    └─ profile 없이 시작 시 에러                                             │
│                                                                             │
│  □ 잘못된 값 입력                                                           │
│    ├─ 음수 체중/키/나이                                                     │
│    ├─ 0원 예산                                                              │
│    └─ meals_per_day > 4 또는 < 1                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 6️⃣ 병렬 실행 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Send API 병렬 실행                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 전문가 3명 병렬 실행                                                     │
│    ├─ 3개 모두 정상 완료                                                    │
│    ├─ 1개 실패 시 나머지 결과 처리                                          │
│    └─ 실행 시간 측정 (순차 대비 개선 확인)                                  │
│                                                                             │
│  □ 검증기 3개 병렬 실행                                                     │
│    ├─ 3개 모두 정상 완료                                                    │
│    └─ 결과 aggregator에서 정상 수집                                         │
│                                                                             │
│  □ State 병합 (Annotated + add)                                             │
│    ├─ expert_recommendations 리스트 병합                                    │
│    └─ validation_results 리스트 병합                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 7️⃣ 성능 테스트

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  응답 시간                                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 1끼니 생성 시간                                                          │
│    └─ 목표: 30초 이내                                                       │
│                                                                             │
│  □ 7일 3끼 (21끼) 전체 시간                                                 │
│    └─ 목표: 10분 이내                                                       │
│                                                                             │
│  □ 재시도 포함 시간                                                         │
│    └─ 끼니당 최대 5회 재시도 시 추가 시간                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  API 비용                                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  □ 1끼니당 토큰 사용량 측정                                                 │
│    ├─ 전문가 3명: ~3,000 tokens                                             │
│    ├─ conflict_resolver: ~1,500 tokens                                      │
│    └─ 검증기 3개: ~500 tokens (LLM 미사용)                                  │
│                                                                             │
│  □ 7일 전체 예상 비용                                                       │
│    └─ Haiku 기준: ~$0.05 예상                                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 8️⃣ 테스트 실행 순서

```
Phase 1: 단위 테스트
─────────────────────
1. □ nutrition.py 함수 테스트 (BMR, TDEE, 매크로)
2. □ 각 노드 개별 테스트 (mock LLM)
3. □ 검증 로직 경계값 테스트

Phase 2: 서브그래프 테스트
─────────────────────
4. □ meal_planning_subgraph 단독 실행
5. □ validation_subgraph 단독 실행
6. □ 병렬 실행 + State 병합 확인

Phase 3: 통합 테스트
─────────────────────
7. □ 전체 그래프 1일 1끼 (mock LLM)
8. □ 전체 그래프 1일 3끼 (mock LLM)
9. □ 재시도 시나리오 (mock으로 강제 실패)

Phase 4: 실제 LLM 테스트
─────────────────────
10. □ 1일 1끼 실제 API
11. □ 페르소나 1-2 테스트
12. □ 재시도 실제 동작 확인

Phase 5: 전체 플로우 테스트
─────────────────────
13. □ 7일 3끼 전체 실행
14. □ 모든 페르소나 테스트
15. □ SSE 스트리밍 E2E 테스트
```

---
